<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·∫£i C·ª©u R√πa Con</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7e1a3; /* M√†u n·ªÅn c√°t */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 700px;
            width: 100%;
        }
        .problem-text {
            font-size: 1.5rem;
            color: #004d40; /* M√†u ch·ªØ xanh l√° c√¢y ƒë·∫≠m */
            margin-bottom: 20px;
            min-height: 100px;
            font-weight: bold;
        }
        .input-and-button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
        }
        .input-field {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #a8c0ff;
            text-align: center;
            font-size: 1.25rem;
            width: 100%;
            max-width: 200px;
            margin-top: 10px;
        }
        .submit-button {
            background-color: #4b83f0;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }
        .submit-button:hover {
            background-color: #3b6edc;
        }
        .feedback-message {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            min-height: 30px;
        }
        .correct {
            color: #22bb33; /* M√†u xanh l√° c√¢y cho ƒë√°p √°n ƒë√∫ng */
        }
        .incorrect {
            color: #ff4444; /* M√†u ƒë·ªè cho ƒë√°p √°n sai */
        }
        .game-status {
            font-size: 1.2rem;
            color: #008080;
            margin-bottom: 20px;
        }
        .path {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            font-size: 4rem;
        }
        .turtle-emoji {
            animation: move-turtle 2s forwards;
        }
        @keyframes move-turtle {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(100px); /* T√πy ch·ªânh kho·∫£ng c√°ch di chuy·ªÉn */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-bold mb-6 text-blue-800">Gi·∫£i C·ª©u R√πa Con</h1>
        <div class="game-status">
            C√¢u h·ªèi <span id="current-question">1</span> / <span id="total-questions"></span>
        </div>
        <div id="path" class="path">
            <span id="turtle" style="opacity: 0;">üê¢</span>
            <span id="obstacle1" style="opacity: 1;">ü™®</span>
            <span id="obstacle2" style="opacity: 1;">ü™µ</span>
            <span id="obstacle3" style="opacity: 1;">üèùÔ∏è</span>
            <span id="finish-line" style="opacity: 0;">üåä</span>
        </div>
        <div id="problem" class="problem-text"></div>
        <div class="input-and-button-container">
            <input type="number" id="answer-input" class="input-field" placeholder="Nh·∫≠p ƒë√°p √°n...">
            <button id="submit-button" class="submit-button">Gi·∫£i b√†i to√°n</button>
        </div>
        <div id="feedback-message" class="feedback-message"></div>
        <a href="../login_student.php" class="game-button">Quay v·ªÅ Trang Ch√≠nh</a>
    </div>

    <script>
        // L·∫•y c√°c ph·∫ßn t·ª≠ HTML c·∫ßn thi·∫øt
        const problemEl = document.getElementById('problem');
        const answerInput = document.getElementById('answer-input');
        const submitButton = document.getElementById('submit-button');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const turtleEl = document.getElementById('turtle');
        const obstacles = [
            document.getElementById('obstacle1'),
            document.getElementById('obstacle2'),
            document.getElementById('obstacle3')
        ];
        const finishLine = document.getElementById('finish-line');
        const container = document.querySelector('.container');

        let wordProblems = [];
        let currentProblemIndex = 0;

        // H√†m t·∫°o m·ªôt b√†i to√°n ƒë·ªë ng·∫´u nhi√™n
        function createRandomProblem() {
            const operation = Math.floor(Math.random() * 4); // 0: +, 1: -, 2: x, 3: /
            let text = "";
            let answer = 0;
            let num1, num2, num3;

            switch(operation) {
                case 0: // Ph√©p c·ªông
                    num1 = Math.floor(Math.random() * 50) + 10;
                    num2 = Math.floor(Math.random() * 50) + 10;
                    answer = num1 + num2;
                    text = `Trong m·ªôt khu v∆∞·ªùn c√≥ ${num1} b√¥ng hoa h·ªìng v√† ${num2} b√¥ng hoa c√∫c. H·ªèi khu v∆∞·ªùn ƒë√≥ c√≥ t·∫•t c·∫£ bao nhi√™u b√¥ng hoa?`;
                    break;
                case 1: // Ph√©p tr·ª´
                    num1 = Math.floor(Math.random() * 100) + 50;
                    num2 = Math.floor(Math.random() * (num1 - 20)) + 10;
                    answer = num1 - num2;
                    text = `M·ªôt ƒë√†n b∆∞·ªõm c√≥ ${num1} con. Sau ƒë√≥, ${num2} con b∆∞·ªõm bay ƒëi. H·ªèi c√≤n l·∫°i bao nhi√™u con b∆∞·ªõm?`;
                    break;
                case 2: // Ph√©p nh√¢n
                    num1 = Math.floor(Math.random() * 8) + 2;
                    num2 = Math.floor(Math.random() * 8) + 2;
                    answer = num1 * num2;
                    text = `M·ªói gi·ªè c√≥ ${num1} qu·∫£ t√°o. C√≥ ${num2} gi·ªè nh∆∞ v·∫≠y. H·ªèi c√≥ t·∫•t c·∫£ bao nhi√™u qu·∫£ t√°o?`;
                    break;
                case 3: // Ph√©p chia
                    num2 = Math.floor(Math.random() * 5) + 2;
                    answer = Math.floor(Math.random() * 8) + 2;
                    num1 = answer * num2;
                    text = `C√≥ ${num1} vi√™n k·∫πo ƒë∆∞·ª£c chia ƒë·ªÅu cho ${num2} b·∫°n. H·ªèi m·ªói b·∫°n nh·∫≠n ƒë∆∞·ª£c bao nhi√™u vi√™n k·∫πo?`;
                    break;
            }
            return { text: text, answer: answer };
        }

        // H√†m t·∫°o m·ªôt b·ªô b√†i to√°n m·ªõi
        function generateNewProblems() {
            wordProblems = [];
            for (let i = 0; i < 4; i++) {
                wordProblems.push(createRandomProblem());
            }
            totalQuestionsEl.textContent = wordProblems.length;
        }

        // H√†m hi·ªÉn th·ªã b√†i to√°n m·ªõi
        function displayProblem() {
            if (currentProblemIndex < wordProblems.length) {
                const problem = wordProblems[currentProblemIndex];
                problemEl.textContent = problem.text;
                currentQuestionEl.textContent = currentProblemIndex + 1;
                answerInput.value = '';
                feedbackMessageEl.textContent = '';
                submitButton.disabled = false;
                answerInput.disabled = false;
            } else {
                endGame();
            }
        }

        // H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng click v√†o n√∫t "Gi·∫£i b√†i to√°n"
        function handleSubmit() {
            const userAnswer = parseInt(answerInput.value);
            const problem = wordProblems[currentProblemIndex];

            submitButton.disabled = true;
            answerInput.disabled = true;

            if (userAnswer === problem.answer) {
                feedbackMessageEl.textContent = 'ƒê√öNG R·ªíI! üéâ';
                feedbackMessageEl.classList.remove('incorrect');
                feedbackMessageEl.classList.add('correct');
                
                // ·∫®n ch∆∞·ªõng ng·∫°i v·∫≠t
                if (currentProblemIndex < obstacles.length) {
                    obstacles[currentProblemIndex].style.opacity = '0';
                }

                currentProblemIndex++;
                
                // Di chuy·ªÉn r√πa
                if (currentProblemIndex === 1) {
                    turtleEl.style.opacity = '1';
                }
                if (currentProblemIndex <= obstacles.length) {
                    // C·∫≠p nh·∫≠t v·ªã tr√≠ r√πa
                    turtleEl.style.transform = `translateX(${currentProblemIndex * 100}px)`;
                }
                
                setTimeout(() => {
                    displayProblem();
                }, 1500);

            } else {
                feedbackMessageEl.textContent = 'SAI R·ªíI! H√£y th·ª≠ l·∫°i üò¢';
                feedbackMessageEl.classList.remove('correct');
                feedbackMessageEl.classList.add('incorrect');
                submitButton.disabled = false;
                answerInput.disabled = false;
            }
        }

        // H√†m k·∫øt th√∫c tr√≤ ch∆°i
        function endGame() {
            problemEl.textContent = 'Ch√∫c m·ª´ng c√°c em ƒë√£ gi·∫£i c·ª©u ƒë∆∞·ª£c r√πa con!';
            answerInput.style.display = 'none';
            submitButton.style.display = 'none';
            feedbackMessageEl.textContent = '';
            finishLine.style.opacity = '1';
            turtleEl.style.transform = 'translateX(300px)'; // Di chuy·ªÉn r√πa ƒë·∫øn cu·ªëi c√πng

            const playAgainButton = document.createElement('button');
            playAgainButton.textContent = 'Ch∆°i l·∫°i';
            playAgainButton.classList.add('play-again-button');
            playAgainButton.style.marginTop = '20px';
            playAgainButton.onclick = resetGame;
            container.appendChild(playAgainButton);
        }

        // H√†m kh·ªüi ƒë·ªông l·∫°i tr√≤ ch∆°i
        function resetGame() {
            currentProblemIndex = 0;
            answerInput.style.display = 'block';
            submitButton.style.display = 'block';
            turtleEl.style.opacity = '0';
            turtleEl.style.transform = 'translateX(0px)';
            obstacles.forEach(obs => obs.style.opacity = '1');
            finishLine.style.opacity = '0';
            const oldPlayAgainButton = container.querySelector('.play-again-button');
            if (oldPlayAgainButton) {
                oldPlayAgainButton.remove();
            }
            generateNewProblems(); // T·∫°o b·ªô c√¢u h·ªèi m·ªõi
            displayProblem();
        }

        // C√†i ƒë·∫∑t ban ƒë·∫ßu
        submitButton.addEventListener('click', handleSubmit);
        answerInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleSubmit();
            }
        });
        resetGame(); // Kh·ªüi ƒë·ªông tr√≤ ch∆°i l·∫ßn ƒë·∫ßu
    </script>
</body>
</html>
